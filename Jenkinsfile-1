pipeline {
  agent {
    docker {
      image 'node:14'  // specify the Node.js version you need
      args '-u root'   // use root user to avoid permission issues
    }
  }

  environment {
    SONARQUBE_HOST_URL = 'http://localhost:9000'
    SONARQUBE_LOGIN = 'sqa_1688f05d029be9e2f0ab98d4a6a8195073adbcf5'
  }

  stages {
    stage('Build and Test') {
      steps {
        sh 'npm install'
        sh 'npm run test'
      }
    }

    stage('SonarQube analysis') {
      steps {
        withSonarQubeEnv('SonarQube') {
          sh 'sonar-scanner'
        }
      }
    }
  }
}
